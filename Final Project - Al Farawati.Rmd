---
title: "Final Project"
author: "Raghed Al Farawati"
date: "`r Sys.Date()`"
output: 
  html_document: 
    theme: united
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Trends and Success Patterns in Houston Manufacturing Businesses: An R Analysis
### Raghed Al Farawati
### `r format(Sys.Date(), '%B %d, %Y')`

## Introduction
Have you wondered about the importance of trends in the businesses around you and how that could determine their degree of success? Manufacturing businesses are an important sector of our life where crucial aspects of it are dependent on these businesses. The Kinder Institute of Urban Research at Rice University in Houston has an interesting data set about the manufacturing businesses in Houston. The data set provides insight into the different business types and their corresponding revenue categories in 2018 - 2021. 
Analyzing the data will be done by using the R language and its dplyr and ggplot2 packages—known for data science, manipulation, and visualization—for trend analysis. Also, shiny, and plotly applications may be implemented for data visualization. These tools will illustrate trends of manufacturing businesses in Houston, emphasizing the successful businesses in the area. To sum up, analyzing this data and highlighting these trends will help many people, of them are individuals in academia who might use the trends in their studies and research. 

### Packages Required
The following packages are attached to the IDE for analyzing the data. 

```{r 1 libraries}
library(rmarkdown, quietly = TRUE) # this package is for dynamic markdown (.rmd)                                      file
library(tidyverse, quietly = TRUE) # this package is main package for data                                           manipulation and tidying 
library(tidyr, quietly = TRUE)     # this package is for tidying the data
library(tibble, quietly = TRUE)    # this package is for creating tibbles and                                        re-imaging the data frame
library(dplyr, quietly = TRUE)     # this package is for data manipulation  
library(ggplot2, quietly = TRUE)   # this package is for data visualization 
library(plotly, quietly = TRUE)    # this package is for interactive plots
library(scales, quietly = TRUE)    # this package is for scaling data 
library(colorspace, quietly = TRUE)   
                                   # this package is for color plalette for                                          large number of categories for                                                  visualization
library(readr, quietly = TRUE)     # this package is for reading data from
                                   # delimited file, such as .csv file
library(stringr, quietly = TRUE)   # this package is for text data, for the                                          `str_remove()` function in the code
``` 


## Data Preparation 
The following data set will be used in this project. 

```{r 2 import data}
# import `vi_manuf2018plus` data set
vi_manuf2018plus <- read_csv("vi_manuf2018plus.csv")
View(vi_manuf2018plus)
```

**Source:** Data Axle & Kinder Institute For Urban Research-Urban Data Platform Team. (2021). Counts of Manufacturing Businesses - Houston MSA - 2018-2021 (Version 1) [dataset]. Rice University. <https://doi.org/10.25612/837.RDB506Y63571>.

*Hold Shift + Click to open file.*

One peculiarity that the website mentions about the source of the data:
It is uncertain if a change in the number of firms inventoried from one year to the next is due to businesses emerging or vanishing in a specific location, or to changes in Data Axle's data-gathering procedures. The source datasets have a YrEstab (year established) variable, although it is null in 75% of the records. The YrAppYp (the year the business first appeared in the Yellow Pages directory) is never null, but it cannot be used to identify when a business was started; in this subset, it only equals the year established value (when known) in around 60% of cases.
More information about the source of the data, according to the kinderup.org:
The dataset is available for download on this website and is organized into three tables. Most users will just require the vi_manuf2018plus table. Users who wish to deal solely with coded values and a codebook should use the manuf2018plus and manuf2018plus_code tables.
Please be aware that rows displaying subtotals for combinations of the naics_code, employee_size, and revenue_category variables are included.
The 2018 dataset has a date stamp of 2/12/2019. The datasets for 2019, 2020, and 2021 include date stamps from May or June of their respective years.

```{r 3 glimpse}
# glimpse function display info about the data set
glimpse(vi_manuf2018plus) 
```

Now, data cleaning. The data set will be scanned and checked for any missing or duplicate values. But before that, checking data types in the data set comes first. 

```{r 4 data types}
# view data types of columns 
data_types <- sapply(vi_manuf2018plus, class)

# print
data_types
```

Now, check for missing values. This code will return the total number of occurrences of the NA values in the data set.

```{r 5 missing values}
# check for missing values
missing_val <- vi_manuf2018plus %>%
  summarize_all(function(x) sum(is.na(x)))

# print
missing_val
```

The NA values rows will create inaccuracies and must be deleted.

```{r 6 del missing values}
# deleting rows with missing values
vi_manuf2018plus <- na.omit(vi_manuf2018plus)
```

Upon eye-blinking the data set. There are different values other than the ones in the column. This code will filter and find the count of different values that occurred in the data set.

```{r 7 outliers}
# filter for outliers  
outliers <- vi_manuf2018plus %>%
  apply(2, function(x) !any(str_detect(x, regex("Total", ignore_case = TRUE))))

outliers <- vi_manuf2018plus %>%
  apply(2, function(x) !any(str_detect(x, regex("All businesses with NAICS codes starting with 311-316, 321-327, 331-337, 339", ignore_case = TRUE))))

# find the occurrences of outliers
outliers_total_count <- sum(apply(vi_manuf2018plus, 2, function(x) grepl("Total", x, ignore.case = TRUE)))

# find the occurrences of outliers
outliers_total_all <- sum(apply(vi_manuf2018plus, 2, function(x) grepl("All businesses with NAICS codes starting with 311-316, 321-327, 331-337, 339", x, ignore.case = TRUE)))

# print
outliers_total_count 
outliers_total_all
```

Due to the inaccuracy this value will cause in the interpretation of this data set, the rows with this different value will be dropped as well.

```{r 8 del outliers}
# delete the outliers values from the data set
vi_manuf2018plus <- vi_manuf2018plus %>%
  rowwise() %>%
  filter(!any(str_detect(across(everything()), regex("Total", ignore_case = TRUE))))

vi_manuf2018plus <- vi_manuf2018plus %>%
  rowwise() %>%
  filter(!any(str_detect(across(everything()), regex("All businesses with NAICS codes starting with 311-316, 321-327, 331-337, 339", ignore_case = TRUE))))

# assign the outliers count variable to the deletion code for later inspection
outliers_total_count <- sum(apply(vi_manuf2018plus, 2, function(x) any(str_detect(x, regex("Total", ignore_case = TRUE))))) 

outliers_total_all <- vi_manuf2018plus %>%
  rowwise() %>%
  filter(!any(str_detect(across(everything()), regex("All businesses with NAICS codes starting with 311-316, 321-327, 331-337, 339", ignore_case = TRUE)))) 
```

In order to check that the data is clean, the total number of instances must be zeros for both inaccuracies.

```{r 9 debug}
# check and debug after data clean up

# check for missing values 
# calculate the total number of NA values in the data set
total_na <- sum(is.na(vi_manuf2018plus))

# print the total number of NA values
total_na


# check outliers number of occurrences
outliers_total_count
outliers_total_all

# check data types for each column again to check
data_types
```

All the variables will be used in the analysis.
Here is a `tibble` display of the clean data. 

```{r 10 data tibble}
# illustrate data set as tibble
tibble <- as_tibble(vi_manuf2018plus)

# print
tibble
```

Fundamentally, yr is the year that the data was collected. `naics_code` and `naics_code_descr` are for the NAICS code mentioned above, and `revenue_category` has the revenues of those businesses categorized in different ranges. `employee_size` is a range of the number of employees in that company, while `number_of_biz` is the count of businesses in the criteria that is in the row. 

## Explatory Data Analysis 

This data set has `naics_code_descr`, `revenue_category`, and `employee_size` all with different categories. All distinct categories in these 3 columns will be shown as a guide to interpret the data set.

```{r 11 distinct categories}
# find distinct categories in each column 

# for naics code
descr_categories <- vi_manuf2018plus %>% 
  select(naics_code) %>%
  distinct()

# for revenue category
revenue_categories <- vi_manuf2018plus %>%
  select(revenue_category) %>%
  distinct()

# for employee size 
empl_size_categories <- vi_manuf2018plus %>%
  select(employee_size) %>%
  distinct()

# combine all variables of distinct occurrences into a list
distinct <- list(
  code_categories       = unique(vi_manuf2018plus$naics_code),
  descr_categories      = unique(vi_manuf2018plus$naics_code_descr),
  revenue_categories    = unique(vi_manuf2018plus$revenue_category),
  empl_size_categories  = unique(vi_manuf2018plus$employee_size)
)

# print 
distinct
```

To take a closer look on the success of these businesses, their yearly growth can be analyzed based on thier counts. 

```{r 12.1 yearly growth}
# calculating the yearly growth
yearly_growth <- vi_manuf2018plus %>%
  group_by(yr, naics_code_descr) %>%
  summarise(number_of_biz = sum(number_of_biz), .groups = "drop") %>%
  mutate(growth_rate = paste0(round(((number_of_biz - lag(number_of_biz)) / lag(number_of_biz)) * 100, 4), "%"))

# create a new column with abbreviated labels for easy visualization
yearly_growth$short_descr <- abbreviate(yearly_growth$naics_code_descr)

# print
yearly_growth
```
Here is a bar `plotly` plot that visualizes the yearly growth of all the businesses.

*Note:* To insure accuracy, rows with NA values are excluded from `yearly_growth`. Necessary conversions are done to the columns so values are used in calculations and visualization. To ensure visuals visibility, naics_code_descr column categories are

```{r 12.2 plot}
# exclude rows with NA value
yearly_growth <- yearly_growth %>% filter(!is.na(growth_rate))
yearly_growth <- yearly_growth %>% filter(!is.na(number_of_biz))

# convert `growth_rate` column to numeric
yearly_growth$growth_rate <- as.numeric(str_remove(yearly_growth$growth_rate, "%"))

# convert `yr` column to numeric and `naics_code_descr` column to factor
yearly_growth$naics_code_descr <- as.factor(yearly_growth$naics_code_descr)

# sort the data frame by yr 
yearly_growth <- yearly_growth %>% arrange(yr) 


# Plotly bar plot
plot_ly(yearly_growth, 
        x = ~reorder(short_descr, -growth_rate), 
        y = ~growth_rate, 
        type = "bar", 
        marker = list(color = 'red')) %>%
  layout(title = "Growth Rate by Category",
         xaxis = list(title = "Category", tickangle = -90),
         yaxis = list(title = "Growth Rate (%)", tickformat = ".0%"))
```

Machinary manufacturing has finally recorded the highest growth rate, while apparel manufacturing recorded the least growth rate.

Here is a similar plotly plot, but a scatter one. 

```{r 12.3 plot}
# plotly scatter plot
plot_ly(yearly_growth, x = ~ short_descr, y = ~growth_rate, type = 'scatter', mode = 'markers', marker = list(color = ~ 'red')) %>%
  layout(title = "Yearly Growth Rate By Category",
         xaxis = list(title = "Category"),
         yaxis = list(title = "Growth Rate (%)"))
```

Here is a plotly box plot of the businesses yearly growth by category.  

```{r 12.4 plot}
# plotly box plot
plot_ly(yearly_growth, 
        x = ~as.factor(short_descr), 
        y = ~growth_rate, 
        type = "box", 
        color = ~as.factor(yr), 
        colors = "red") %>%
  layout(title = "Yearly Growth Rate By Category",
         xaxis = list(title = "Year"),
         yaxis = list(title = "Growth Rate (%)"))
```

Another way to look at the success of these businesses would be through an analysis of the number of businesses in each category.

```{r 13.1 num of biz analysis}
# calculate the number of businesses 
num_of_biz_analysis <- vi_manuf2018plus %>%
  group_by(naics_code_descr) %>%
  summarise(total_number_of_biz = sum(number_of_biz)) %>%
  arrange(desc(total_number_of_biz))

# create a new column with abbreviated labels for easy visualization
num_of_biz_analysis$short_descr <- abbreviate(num_of_biz_analysis$naics_code_descr)

# print
num_of_biz_analysis

```
There is the total number of bushinesses of each business categories. 

```{r 13.2 plot}
# plotly bar plot
plot_ly(num_of_biz_analysis, 
               x = ~reorder(short_descr, -total_number_of_biz), 
               y = ~total_number_of_biz, 
               type = 'bar', 
               color = ~short_descr, 
               colors = 'Dark2') %>%
  layout(title = "Number of Business Analysis for Each Category",
         xaxis = list(title = "NAICS Code Description", tickangle = -90),
         yaxis = list(title = "Number of Businesses"))
```
Miscellaneous Manufacturing here dominates the majority, while Leather and Allied Product Manufacturing is so rare.

Here is a scatter plot that demonstrates how dominant / rare the businesses are.

```{r 13.3 plot}
# plotly scatter plot
plot_ly(num_of_biz_analysis, 
               x = ~total_number_of_biz, 
               y = ~reorder(short_descr, -total_number_of_biz), 
               type = 'scatter', 
               mode = 'markers', 
               marker = list(color = 'red')) %>%
  layout(title = "Total Number of Businesses by Category",
         xaxis = list(title = "Total Number of Businesses"),
         yaxis = list(title = "Business Category"))
```


Here is the same illustration but in a bar plot. 

```{r 13.5 plot}
# plotly bar plot
plot_ly(num_of_biz_analysis, x = ~total_number_of_biz, y = ~short_descr, type = 'bar', orientation = 'h', marker = list(color = 'red')) %>%
  layout(title = "Total Number of Businesses by Category",
         xaxis = list(title = "Total Number of Businesses"),
         yaxis = list(title = "Business Category"))
```

Money! Whenever there is money, there is success. So, showing how successful these business categories can be through revenue per business analysis.
 
```{r 14.1 revenue per biz}
# assign a unique numeric ID to each revenue category
# purpose: to enable calculation of values 
vi_manuf2018plus <- vi_manuf2018plus %>%
  mutate(revenue_category_id = as.numeric(factor(revenue_category)))

# calculate the revenue per business for each category
vi_manuf2018plus <- vi_manuf2018plus %>%
  mutate(revenue_per_biz = ifelse(number_of_biz != 0, revenue_category_id / number_of_biz, 0))
  
# calculate the average revenue per business for each category
revenue_per_biz <- vi_manuf2018plus %>%
  group_by(naics_code_descr) %>%
  summarise(avg_revenue_per_biz = mean(revenue_per_biz, na.rm = TRUE)) %>%
  arrange(desc(avg_revenue_per_biz))

# create a new column with abbreviated labels for easy visualization
revenue_per_biz$short_descr <- abbreviate(revenue_per_biz$naics_code_descr)

# print
revenue_per_biz
```

```{r 14.2 plot}
# plotly bar plot
plot_ly(revenue_per_biz, x = ~reorder(short_descr, -avg_revenue_per_biz), y = ~avg_revenue_per_biz, type = 'bar', name = 'Average Revenue per Business', marker = list(color = 'red')) %>%
  layout(title = "Average Revenue per Business for Each Category",
         xaxis = list(title = "NAICS Code Description"),
         yaxis = list(title = "Average Revenue per Business"))
```

It is clear that most of the categories have revenues close to each other, with Food Manufacturing having the highest average revenue and Apparel Manufacturing having the lowest average revenue. 
 
Here is a scatter plot illustrating the business category averages of revenue.

```{r 14.3 plot}
# plotly plot
plot_ly(revenue_per_biz, x = ~short_descr, y = ~avg_revenue_per_biz, type = 'scatter', mode = 'markers', name = 'Average Revenue per Business', marker = list(color = 'red')) %>%
  layout(title = "Average Revenue per Business for Each Category",
         xaxis = list(title = "NAICS Code Description"),
         yaxis = list(title = "Average Revenue per Business"))
```

Finally, the focus of this project was the exploration and analysis of manufacturing businesses in Houston, as detailed in a data set from the Kinder Institute of Urban Research at Rice University. The data set provided a wealth of insights into various business types and their corresponding revenue categories for the year 2018 - 2021. 

To delve into this data, the R programming language was employed, leveraging its powerful packages such as dplyr and ggplot2. These packages are renowned for their capabilities in data science, manipulation, and visualization. Additionally, applications like Shiny and Plotly were used to create interactive and dynamic visualizations. The analysis was centered around three key aspects: the yearly growth of businesses, the total number of businesses in each category, and the average revenue per business for each category.

The analysis unveiled several intriguing trends. For instance, 'Miscellaneous Manufacturing' emerged as the most common business category, while 'Apparel Manufacturing' was the least common. In terms of growth rate, 'Machinery Manufacturing' recorded the highest, indicating a thriving sector. When it came to revenue, most categories were found to have similar revenues, with 'Food Manufacturing' leading the pack and 'Apparel Manufacturing' at the bottom.

These findings offer valuable insights into the performance and trends of different business categories. They can guide stakeholders, including academics and researchers, in making informed decisions and conducting further studies. The trends highlighted in this analysis are particularly useful for understanding the dynamics of the manufacturing sector in Houston.

While the analysis provides useful insights, it does have some limitations. It assumes the accuracy and currency of the data, which may not always hold true. Also, it does not take into account other potentially influential factors such as geographical location, market conditions, and government policies. Future work could aim to incorporate these factors into the analysis and employ more sophisticated statistical techniques to model and predict trends.