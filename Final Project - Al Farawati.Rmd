---
title: "Final Project"
author: "Raghed Al Farawati"
date: "`r Sys.Date()`"
output: html_document
---

```{r 1 setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Trends and Success Patterns in 2018 Houston Manufacturing Businesses: An R Analysis
# Raghed Al Farawati
# `r format(Sys.Date(), '%B %d, %Y')`


## Introduction
Have you wondered about the importance of trends in the businesses around you and how that could determine their degree of success? Manufacturing businesses are an important sector of our life where crucial aspects of it are dependent on these businesses. The Kinder Institute of Urban Research at Rice University in Houston has an interesting data set about the manufacturing businesses in Houston. The data set provides insight into the different business types and their corresponding revenue categories in 2018. 
Analyzing the data will be done by using the R language and its dplyr and ggplot2 packages—known for data science, manipulation, and visualization—for trend analysis. Also, shiny, and plotly applications may be implemented for data visualization. These tools will illustrate trends of manufacturing businesses in Houston, emphasizing the successful businesses in the area. To sum up, analyzing this data and highlighting these trends will help many people, of them are individuals in academia who might use the trends in their studies and research. 



## Packages Required
The following packages are attached to the IDE for analyzing the data. 

```{r 2 libraries}
library(rmarkdown, quietly = TRUE) # this package is for dynamic markdown (.rmd)                                      file
library(tidyverse, quietly = TRUE) # this package is main package for data                                           manipulation and tidying 
library(tidyr, quietly = TRUE)     # this package is for tidying the data
library(tibble, quietly = TRUE)    # this package is for creating tibbles and                                        re-imaging the data frame
library(dplyr, quietly = TRUE)     # this package is for data manipulation  
library(ggplot2, quietly = TRUE)   # this package is for data visualization 
library(shiny, quietly = TRUE)     # this package is for dynamic visualization
```


## Data Preparation 

**Source:** Data Axle & Kinder Institute For Urban Research-Urban Data Platform Team. (2021). Counts of Manufacturing Businesses - Houston MSA - 2018-2021 (Version 1) [dataset]. Rice University. <https://doi.org/10.25612/837.RDB506Y63571>.

*Hold Shift + Click to open file.*

One peculiarity that the website mentions about the source of the data:
It is uncertain if a change in the number of firms inventoried from one year to the next is due to businesses emerging or vanishing in a specific location, or to changes in Data Axle's data-gathering procedures. The source datasets have a YrEstab (year established) variable, although it is null in 75% of the records. The YrAppYp (the year the business first appeared in the Yellow Pages directory) is never null, but it cannot be used to identify when a business was started; in this subset, it only equals the year established value (when known) in around 60% of cases.
More information about the source of the data, according to the kinderup.org:
The dataset is available for download on this website and is organized into three tables. Most users will just require the vi_manuf2018plus table. Users who wish to deal solely with coded values and a codebook should use the manuf2018plus and manuf2018plus_code tables.
Please be aware that rows displaying subtotals for combinations of the naics_code, employee_size, and revenue_category variables are included.
The 2018 dataset has a date stamp of 2/12/2019. The datasets for 2019, 2020, and 2021 include date stamps from May or June of their respective years.

### Data Import 
Data was imported to the IDE, and it has `r nrow(vi_manuf2018plus)` observations of `r ncol(vi_manuf2018plus)` variables.


```{r 3 glimpse}
# glimpse function display info about the data set
glimpse(vi_manuf2018plus) 
```
Now, data cleaning. The data set will be scanned and checked for any missing or duplicate values. But before that, checking data types in the data set comes first. 

```{r 4 data types}
# view data types of columns 
data_types <- sapply(vi_manuf2018plus, class)

# print
data_types
```
Now, check for missing values. 


```{r 5 missing values}
# check for missing values
missing_val <- vi_manuf2018plus %>%
  summarize_all(function(x) sum(is.na(x)))

# print
missing_val
```


```{r 6 del missing values}
# deleting rows with missing values
vi_manuf2018plus <- na.omit(vi_manuf2018plus)
```
It seems that this data set has some missing values. These rows will be dropped from the data set. 

```{r 7 outliers}
# filter for outliers  
outliers <- vi_manuf2018plus %>%
  apply(2, function(x) !any(str_detect(x, regex("Total", ignore_case = TRUE))))

# find the occurrences of outliers
outliers_total_count <- sum(apply(vi_manuf2018plus, 2, function(x) grepl("Total", x, ignore.case = TRUE)))

# print
outliers_total_count 
```
Finally, upon visually checking for outliers, found an unusual value in the `revenue_category` column, which is “Total”, which looks oddly different than its column values. These values will be dropped as well. 

```{r 8 del outliers}
# delete the outliers values from the data set
vi_manuf2018plus <- vi_manuf2018plus %>%
  rowwise() %>%
  filter(!any(str_detect(across(everything()), regex("Total", ignore_case = TRUE))))

# assign the outliers count variable to the deletion code for later inspection
outliers_total_count <- sum(apply(vi_manuf2018plus, 2, function(x) any(str_detect(x, regex("Total", ignore_case = TRUE)))))
```


All the variables will be used in the analysis.
Here is a `tibble` display of the clean data. 

```{r 9 debug}
# check and debug after data clean up

# check for missing values 
# calculate the total number of NA values in the data set
total_na <- sum(is.na(vi_manuf2018plus))

# print the total number of NA values
total_na


# check outliers number of occurrences
outliers_total_count

# check data types for each column again to check
data_types
```
Fundamentally, yr is the year that the data was collected. `naics_code` and `naics_code_descr` are for the NAICS code mentioned above, and `revenue_category` has the revenues of those businesses categorized in different ranges. `employee_size` is a range of the number of employees in that company, while `number_of_biz` is the count of businesses in the criteria that is in the row. 

```{r 10 data tibble}
# illustrate data set as tibble
tibble <- as_tibble(vi_manuf2018plus)

# print
tibble
```

## Explatory Data Analysis 

```{r 11 distinct categories}
# find distinct categories in each column 

# for naics code
descr_categories <- vi_manuf2018plus %>% 
  select(naics_code) %>%
  distinct()

# for revenue category
revenue_categories <- vi_manuf2018plus %>%
  select(revenue_category) %>%
  distinct()

# for employee size 
empl_size_categories <- vi_manuf2018plus %>%
  select(employee_size) %>%
  distinct()

# combine all variables of distinct occurrences into a list
distinct <- list(
  code_categories       = unique(vi_manuf2018plus$naics_code),
  descr_categories      = unique(vi_manuf2018plus$naics_code_descr),
  revenue_categories    = unique(vi_manuf2018plus$revenue_category),
  empl_size_categories  = unique(vi_manuf2018plus$employee_size)
)

# print 
distinct
```



```{r 12 empl size analysis}
if(FALSE){
# perform the employee size analysis
empl_size_analysis <- vi_manuf2018plus %>%
  group_by(yr, naics_code_descr, employee_size) %>%
  summarise(count = n(), .groups = "drop") %>%
  arrange(desc(count))

# Convert employee_size to a factor
empl_size_analysis$employee_size <- as.factor(empl_size_analysis$employee_size)

# glimpse the result
glimpse(empl_size_analysis)
} 



# code I might need 

if(FALSE){
  # Your code here
}

```


```{r 13 empl size analysis plot}
if(FALSE){
# stacked bar plot of the employee size analysis
empl_size_plot <- ggplot(empl_size_analysis, aes(x = yr, y = count, fill = employee_size)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(title = "Employee Size Analysis", x = "Year", y = "Count", fill = "Employee Size") +
  theme(plot.title = element_text(hjust = 0.5))

# view 
empl_size_plot
}
```


```{r yearly growth }
# finding the yearly growth
yearly_growth <- vi_manuf2018plus %>%
  group_by(yr, naics_code_descr) %>%
  summarise(number_of_biz = sum(number_of_biz)) %>%
  mutate(growth_rate = (number_of_biz - lag(number_of_biz)) / lag(number_of_biz) * 100)

# Print the result
yearly_growth

```


```{r}
yearly_growth_plot <- ggplot(yearly_growth_analysis, aes(x = yr, y = growth_rate, color = naics_code_descr)) +
  geom_line() +
  theme_minimal() +
  labs(title = "Yearly Growth Analysis", x = "Year", y = "Growth Rate (%)", color = "NAICS Code Description") +
  theme(plot.title = element_text(hjust = 0.5))

yearly_growth_plot
```


```{r num of biz analysis}
# Perform the business analysis
num_of_biz_analysis <- vi_manuf2018plus %>%
  group_by(naics_code_descr) %>%
  summarise(total_number_of_biz = sum(number_of_biz)) %>%
  arrange(desc(total_number_of_biz))

# Print the result
num_of_biz_analysis

```


```{r}
num_of_biz_plot <- ggplot(business_analysis, aes(x = yr, y = number_of_biz, color = naics_code_descr)) +
  geom_line() +
  theme_minimal() +
  labs(title = "Business Analysis", x = "Year", y = "Number of Businesses", color = "NAICS Code Description") +
  theme(plot.title = element_text(hjust = 0.5))

num_of_biz_plot
```


```{r 13 revenue per biz}
# calculate the revenue per business for each category
revenue_per_biz <- vi_manuf2018plus %>%
  mutate(revenue_per_biz = ifelse(number_of_biz != 0, revenue_numeric / number_of_biz, 0))

# Calculate the average revenue per business for each category
revenue_per_biz <- vi_manuf2018plus %>%
  group_by(naics_code_descr) %>%
  summarise(avg_revenue_per_biz = mean(revenue_per_biz, na.rm = TRUE)) %>%
  arrange(desc(avg_revenue_per_biz))

# Print the average revenue per business for each category
revenue_per_biz

```
The average revenue per business can indeed be a measure of success, but it’s important to note that it’s not the only measure. A higher average revenue per business generally indicates that the businesses in that category are able to generate more revenue, which could be a sign of success. However, this doesn’t necessarily mean that they are more profitable, as they could also have higher costs.

```{r}
revenue_per_biz_plot <- ggplot(revenue_per_biz, aes(x = yr, y = revenue_per_business, color = naics_code_descr)) +
  geom_line() +
  theme_minimal() +
  labs(title = "Revenue per Business Analysis", x = "Year", y = "Revenue per Business", color = "NAICS Code Description") +
  theme(plot.title = element_text(hjust = 0.5))

revenue_per_biz_plot

```

